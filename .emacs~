;; M-x reload-config to reload this file
(defun reload-config ()
  (interactive)
  (load-file user-init-file))

(defun package-install-helper (package)
  "Install PACKAGE if it is not already installed."
  (unless (package-installed-p package)
    (package-install package)))

;; Melpa, package manager
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t) 
(package-initialize)

;; Install
(package-install-helper 'tree-sitter)         ;; tree sitter
(package-install-helper 'tree-sitter-langs)   ;; 
(package-install-helper 'gruber-darker-theme) ;; Tsoding theme
(package-install-helper 'cider)               ;; cider, clj REPL
(package-install-helper 'clojure-ts-mode)     ;; clj major mode, treesitter 
(package-install-helper 'magit)               ;; magic git
(package-install-helper 'company)             ;; complete anything

;; --- Clojure specific setup ---
;; Auto start the REPL on clojure mode
(add-hook 'clojure-ts-mode-hook #'cider-mode)
(add-hook 'clojure-ts-mode-hook #'eldoc-box-hover-mode)
(add-hook 'cider-mode-hook #'eldoc-mode)
;; --- Clojure setup END ---

;; Global hooks
(add-hook 'after-init-hook 'global-company-mode)

;; UI cleanup
(menu-bar-mode 0)
(tool-bar-mode 0)
(scroll-bar-mode 0)
									
;; UI extensions
(global-font-lock-mode 1)				
(load-theme 'gruber-darker t)
(global-display-line-numbers-mode 1)  ;; Enable line numbers
(setq display-line-numbers-type 'relative)

;; Tell emacs to shut up
(setq ring-bell-function 'ignore)

;; Re-map keys
(defun mark-backward-paragraph ()
  "Move backward a paragraph and mark the region."
  (interactive)
  (unless (region-active-p)
    (set-mark-command nil))
  (backward-paragraph))

(defun mark-forward-paragraph ()
  "Move forward a paragraph and mark the region."
  (interactive)
  (unless (region-active-p)
    (set-mark-command nil))
  (forward-paragraph))

(keymap-global-set "M-[" 'backward-paragraph)
(keymap-global-set "M-]" 'forward-paragraph)
(keymap-global-set "M-{" 'mark-backward-paragraph)
(keymap-global-set "M-}" 'mark-forward-paragraph)
(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(package-selected-packages
   '(cider clojure-ts-mode color-theme-sanityinc-tomorrow company
	   doom-themes eldoc-box gruber-darker-theme magit
	   tree-sitter-langs)))
(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 )
